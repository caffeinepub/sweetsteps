{
  "kind": "build_request",
  "title": "Persist onboarding completion in stable storage and remove Landing page SignupTest button",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-5",
      "text": "Persist backend user profile onboarding state in stable storage so `userProfiles` (including `onboardingCompleted`) survives canister upgrades/redeploys and returning authenticated users no longer see onboarding data missing due to backend state resets.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "Please do that and please ensure that everything is in perfect working condition."
        ]
      },
      "acceptanceCriteria": [
        "After calling `completeOnboarding()`, `canAccessOnboarding()` returns `false` for that caller and remains `false` after a canister upgrade (no reinstall).",
        "After a canister upgrade, `getCallerUserProfile()` for an onboarded user returns a non-null profile with `onboardingCompleted = true`.",
        "Existing backend APIs continue to work without signature changes: `completeOnboarding`, `restartOnboarding`, `canAccessOnboarding`, `getCallerUserProfile`, `getUserProfile`, `saveCallerUserProfile`, and `alternateSignup`.",
        "No new traps/regressions are introduced for anonymous callers beyond current behavior.",
        "State restoration logic is deterministic: stable state is the source of truth on upgrade, and in-memory structures are rebuilt from it on startup/post-upgrade."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Remove the temporary/backup SignupTest navigation/button from the Landing page UI so users can no longer access `/signup-test` from the landing hero actions.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "Also, please remove the test signup button from the landing page. It's not required anymore"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/pages/Landing.tsx` no longer renders the \"Test Signup Page\" button/link to `/signup-test`.",
        "Landing page builds cleanly with no unused imports (e.g., remove `TestTube2` if it becomes unused).",
        "All remaining Landing page buttons (Start Climbing, Continue Climbing, Why SweetSteps?) continue to function and render correctly."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo` (no additional backend services).",
    "Only add `backend/migration.mo` if it is required for a state upgrade; otherwise use upgrade hooks/state patterns in the main actor.",
    "Do not edit files under `frontend/immutablePaths` (compose existing UI components instead).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Do not remove the `/signup-test` route/page itself unless explicitly requested; only remove the Landing page button/navigation.",
    "Do not redesign or change the authentication flows beyond what is necessary to persist `userProfiles` across upgrades.",
    "Do not add external databases or third-party storage."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}